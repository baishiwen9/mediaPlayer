!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("MediaPlayer",[],t):"object"==typeof exports?exports.MediaPlayer=t():e.MediaPlayer=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=s(n(1)),r=s(n(4));function s(e){return e&&e.__esModule?e:{default:e}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"initVideo",value:function(e){return(new a.default).init(e)}},{key:"initAudio",value:function(e){return(new r.default).init(e)}}]),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();n(2);var a=function(e){return e&&e.__esModule?e:{default:e}}(n(3));var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.MobileOS=a.default.getMobileOS(),this.state={width:"100%",height:"210px",controls:!0,id:"",videoClass:"iOS"===this.MobileOS?"vd-ready":"vd-preparing",playBtn:"",src:"",poster:"",loop:!1,autoPlay:!1,duration:0,currentTime:0,playing:!1,beatTime:3,showLoading:!0},this.videoPlayer=null}return i(e,[{key:"init",value:function(e){var t=this;if(!a.default.isObj(e))throw new Error("请传入有效的对象参数");return this.setState(e),this.render(),setTimeout(function(){t.state.showLoading&&t.hideLoading()},6e3),this.videoPlayer}},{key:"setState",value:function(e,t){a.default.isObj(e)&&(this.state=Object.assign(this.state,e),t&&"function"==typeof t&&t())}},{key:"render",value:function(){var e=this,t=this.state,n=t.id,i=t.src,r=t.height,s=t.width,o=t.videoClass,l=t.loop,u=t.poster,d=t.autoPlay,c=t.controls,f=t.showLoading,v=this.getElementById(n),h='\n            <div class="media-VideoWrap video-player" style="width: '+s+"; height: "+r+'">\n                <video \n                    id="media-VideoPlayer" \n                    width="'+s+'" \n                    height="'+r+'" \n                    x5-video-orientation="portraint" \n                    x5-video-player-type="h5" \n                    x5-video-player-fullscreen="true" \n                    class="'+o+'" \n                    preload="auto"\n                    x-webkit-airplay="true" \n                    webkit-playsinline="true" \n                    playsinline="true" \n                    poster="'+a.default.replaceProtocol(u)+'"\n                >\n                    <source src="'+a.default.replaceProtocol(i)+'">\n                </video>\n                '+(c?this.renderControls():"")+"\n                "+(f?this.renderLoading():"")+"\n                "+this.renderTimeTip()+"\n                "+this.renderFullScreenHeader()+"\n            </div>";v.innerHTML=h,this.videoPlayer=this.getElementById("media-VideoPlayer"),d&&(this.videoPlayer.setAttribute("autoplay","autoplay"),this.videoPlayer.play(),this.setState({playing:!0},function(){e.setVideoPlayStatus(!0)})),l&&this.videoPlayer.setAttribute("loop","loop"),this.bindEvent(),this.timerid=setTimeout(function(){e.hideControls()},5e3)}},{key:"renderControls",value:function(){var e=this.state,t=e.duration,n=e.currentTime;return this.bindEventOfControls(n,t),'<div class="video-controls show" id="controlsBar">\n                <div id="videoHandler" class="video-playBtn iconfont icon-play"></div>\n                <div class="progressBar-wrap">\n                    <div class="curTime">'+(0===n?"00:00":n)+'</div>\n                    <div class="progressBar">\n                        <div class="bar"></div>\n                        <div class="slider"></div>\n                    </div>\n                    <div class="allTime">'+(0===t?"00:00":t)+'</div>\n                </div>\n                <div class="fullScreenBtn show" id="fullscreenBtn"></div>\n            </div>'}},{key:"getControlsEle",value:function(){return this.getElementByClass("video-controls")}},{key:"hideControls",value:function(){var e=this.getControlsEle();e.classList.remove("show"),e.classList.add("hide")}},{key:"showControls",value:function(e){var t=this;this.timerid&&clearTimeout(this.timerid);var n=this.getControlsEle();n.classList.remove("hide"),n.classList.add("show"),e||(this.timerid=setTimeout(function(){t.hideControls()},5e3))}},{key:"renderTimeTip",value:function(){return'<div class="timeTip_wrap hide">\n                <span class="timeTip_currentTime"></span>/\n                <span class="timeTip_duration"></span>\n            </div>'}},{key:"getTimeTipEle",value:function(){return this.getElementByClass("timeTip_wrap")}},{key:"showTimeTip",value:function(){var e=this.getTimeTipEle();e.classList.remove("hide"),e.classList.add("show")}},{key:"hideTimeTip",value:function(){var e=this.getTimeTipEle();e.classList.remove("show"),e.classList.add("hide")}},{key:"setTimeTipValue",value:function(e,t){var n=this.getElementByClass("timeTip_currentTime"),i=this.getElementByClass("timeTip_duration");this.setInnerHtml(n,e),this.setInnerHtml(i,t)}},{key:"renderLoading",value:function(){return'<div class="loading-wrap show" id="media-VideoLoading">\n                <div class="loading-icon"></div>\n            </div>'}},{key:"getLoadingEle",value:function(){return this.getElementById("media-VideoLoading")}},{key:"showLoading",value:function(){var e=this.getLoadingEle();e.classList.remove("hide"),e.classList.add("show")}},{key:"hideLoading",value:function(){var e=this.getLoadingEle();e.classList.remove("show"),e.classList.add("hide")}},{key:"getElementById",value:function(e){return this.getElement(e,"id")}},{key:"getElementByClass",value:function(e){return this.getElement(e,"class")}},{key:"getElement",value:function(e,t){if(""===e||!e)return document.body;var n="id"===t?document.getElementById(e):document.querySelector("."+e);return n||document.body}},{key:"bindEvent",value:function(){var e=this;if(this.videoPlayer){var t=this.videoPlayer;t.addEventListener("timeupdate",function(t){var n=t.target.currentTime;if(e.setState({currentTime:n},function(){var t=e.getElementByClass("curTime");e.setInnerHtml(t,n)}),!e.state.duration||"00:00"===e.state.duration){var i=t.target.duration;e.setState({duration:i},function(){var t=e.getElementByClass("allTime");e.setInnerHtml(t,i)})}e.getProgressbarWidth(t.target.currentTime,t.target.duration);var r=e.state,s=r.playing,o=r.playingBeatCB,l=r.beatTime;e.startTime?((new Date).getTime()-e.startTime)/1e3>=l&&(e.startTime=(new Date).getTime(),window.console.log("---视频播放了"+l+"秒了---"),s&&a.default.isFunction(o)&&o(t.target.currentTime)):e.startTime=(new Date).getTime();e.setState({showLoading:!1},function(){e.hideLoading()})});var n=this.state.playEndCB;t.addEventListener("ended",function(){e.setVideoPlayStatus(!1),a.default.isFunction(n)&&n()},!1),t.addEventListener("canplaythrough",function(){window.console.log("视频可以正常播放了"),e.setState({showLoading:!1},function(){e.hideLoading()})},!1),t.addEventListener("click",function(t){a.default.stopPropagation(t),"media-VideoPlayer"===t.target.id&&e.showControls()},!1),t.addEventListener("waiting",function(){e.setState({showLoading:!0},function(){e.showLoading()})},!1),t.addEventListener("touchstart",function(t){a.default.stopPropagation(t);var n=e.state.isFullscreen;e.startX=n?t.touches[0].clientY:t.touches[0].clientX,window.console.log("滑动开始"),e.showControls("moveStart");var i=e.getElementByClass("progressBar");e.progressBarWidth=i&&i.offsetWidth},!1),t.addEventListener("touchmove",function(n){a.default.stopPropagation(n),e.showTimeTip();var i=e.state.isFullscreen?n.touches[0].clientY:n.touches[0].clientX;window.console.log("滑动中");var r=i-e.startX,s=e.state,o=s.duration,l=s.currentTime,u=r*e.progressBarWidth/o/1e3+l;u=(u=u<0?0:u)>o?o:u,t.currentTime=u,e.setState({currentTime:u},function(){e.setCurrentTime(u),e.getProgressbarWidth(u,o),e.setTimeTipValue(u,o)})},{passive:!1}),t.addEventListener("touchend",function(t){a.default.stopPropagation(t),window.console.log("滑动结束"),e.startX=0,e.timerid=setTimeout(function(){e.hideControls()},5e3),e.hideTimeTip()},!1),t.addEventListener("play",function(){e.setVideoPlayStatus(!0);var t=e.state.playingCB;a.default.isFunction(t)&&t()}),t.addEventListener("error",function(e){window.console.log("加载视频数据时遇到错误",e)}),t.addEventListener("pause",function(){e.startTime=0,e.setVideoPlayStatus(!1);var t=e.state.pauseCB;a.default.isFunction(t)&&t()}),t.addEventListener("loadedmetadata",function(t){var n=t.target.duration;e.setState({duration:n},function(){var t=e.getElementByClass("allTime");e.setInnerHtml(t,n)})},!1)}}},{key:"bindEventOfControls",value:function(){var e=this,t=this.getElementByClass("video-playBtn");t&&t.addEventListener("click",function(t){(a.default.stopPropagation(t),"videoHandler"===t.target.id)&&(e.state.playing?e.videoPlayer&&e.videoPlayer.pause():e.videoPlayer&&e.videoPlayer.play())},!1);var n=this.getElementByClass("fullScreenBtn");n&&n.addEventListener("click",function(t){if(a.default.stopPropagation(t),"fullscreenBtn"===t.target.id){e.fullScreen(),e.state.playing&&e.videoPlayer.play();var n=e.state,i=n.currentTime,r=n.duration;e.getProgressbarWidth(i,r)}},!1);var i=this.getElementByClass("progressBar-wrap");i&&i.addEventListener("click",function(t){if(a.default.stopPropagation(t),"controlsBar"===t.target.id||t.target.classList.value&&-1!==t.target.classList.value.indexOf("progressBar")){var n=e.state,i=n.duration,r=n.isFullscreen,s=e.getElementByClass("progressBar"),o=s.offsetLeft,l=s.offsetWidth,u=o,d=u+l,c=r?t.clientY:t.clientX;if(c>=d||c<=u)return;var f=(c-u)*i/l;window.console.log("点击了",f),e.playTo(f)}},!1)}},{key:"setVideoPlayStatus",value:function(e){this.setState({playing:e}),this.updatePlayIcon(e)}},{key:"setInnerHtml",value:function(e,t){e&&(e.innerHTML=a.default.formatTime(t))}},{key:"getProgressbarWidth",value:function(e,t){var n=1*e/t*1*100+"%",i=this.getElementByClass("bar"),a=this.getElementByClass("slider");i.style.width=n,a.style.left=n}},{key:"updatePlayIcon",value:function(e){var t=this.getElementByClass("video-playBtn");e?(t.classList.remove("icon-play"),t.classList.add("icon-pause")):(t.classList.remove("icon-pause"),t.classList.add("icon-play"))}},{key:"fullScreen",value:function(){this.setState({isFullscreen:!0}),this.showFullscreenHeader(),window.addEventListener("touchmove",a.default.preventDefault,{passive:!1});var e=this.getElementByClass("media-VideoWrap"),t=document.documentElement.clientWidth||document.body.clientWidth,n=document.documentElement.clientHeight||document.body.clientHeigth,i=Math.abs(n-t)/2+"px";e.style.width=n+"px",e.style.height=t+"px",e.style.transform="rotate(90deg) translate("+i+","+i+")",e.style.webkitTransform="rotate(90deg) translate("+i+","+i+")",e.style.msTransform="rotate(90deg) translate("+i+","+i+")";var r=this.videoPlayer;r.classList.add("rotate"),r.width=n,r.height=t,this.hideFullScreenBtn();var s=this.state.fullScreenCB;a.default.isFunction(s)&&s(),this.bindExitFullscreenEvent()}},{key:"exitFullscreen",value:function(){var e=this.state,t=e.exitFullScreenCB,n=e.height;if(e.isFullscreen){this.setState({isFullscreen:!1}),this.showFullscreenBtn(),this.hideFullScreenHeader(),a.default.isFunction(t)&&t(),window.removeEventListener("touchmove",a.default.preventDefault);var i=this.getElementByClass("media-VideoWrap");i.style.width="100%",i.style.height=n,i.style.transform="rotate(360deg)",i.style.webkitTransform="rotate(360deg)",i.style.msTransform="rotate(360deg)";var r=this.videoPlayer;r.classList.remove("rotate"),r.width=window.innerWidth,r.height=parseInt(n)}}},{key:"getFullscreenBtnEle",value:function(){return this.getElementById("fullscreenBtn")}},{key:"showFullscreenBtn",value:function(){var e=this.getFullscreenBtnEle();e.classList.remove("hide"),e.classList.add("show")}},{key:"hideFullScreenBtn",value:function(){var e=this.getFullscreenBtnEle();e.classList.remove("show"),e.classList.add("hide")}},{key:"renderFullScreenHeader",value:function(){return'\n            <div class="fullScreen-header hide">\n                <div id="fullScreen-header-backBtn" class="fullScreen-header-backBtn iconfont icon-back"></div>\n                <div class="fullScreen-header-title">'+document.title+"</div>\n            </div>\n            "}},{key:"showFullscreenHeader",value:function(){var e=this.getElementByClass("fullScreen-header");e.classList.remove("hide"),e.classList.add("show")}},{key:"hideFullScreenHeader",value:function(){var e=this.getElementByClass("fullScreen-header");e.classList.remove("show"),e.classList.add("hide")}},{key:"bindExitFullscreenEvent",value:function(){var e=this,t=this.getElementById("fullScreen-header-backBtn");t&&t.addEventListener("click",function(t){if(a.default.stopPropagation(t),"fullScreen-header-backBtn"===t.target.id){e.exitFullscreen();var n=e.state,i=n.currentTime,r=n.duration;e.getProgressbarWidth(i,r)}},!1)}},{key:"playTo",value:function(e){this.videoPlayer.currentTime=e,this.setCurrentTime(e),this.getProgressbarWidth(e,this.state.duration)}},{key:"setCurrentTime",value:function(e){var t=this.getElementByClass("timeTip_currentTime");this.setInnerHtml(t,e)}}]),e}();t.default=r},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={getMobileOS:function(){var e=window.navigator.userAgent||window.navigator.vendor||window.opera;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"unknown"},getProtocol:function(){var e=window.location.protocol;return"file:"===e&&(e="https:"),e},replaceProtocol:function(e){var t=i.getProtocol();return e?e.replace(/(https:)|(http:)/gi,t):""},isObj:function(e){return!(!e||"[object Object]"!==Object.prototype.toString.call(e))},formatTime:function(e){if(!e)return"00:00";var t="",n="";return t=Math.floor(1*e/60)+"",n=(1*e%60+"").split(".")[0],(t=1===t.length?"0"+t:t)+":"+(n=1===n.length?"0"+n:n)},stopPropagation:function(e){(e=e||window.event).stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1},isFunction:function(e){return!(!e||"function"!=typeof e)},throttle:function(e,t){window.console.log("throttle",this);var n=null;return function(){n||(n=setTimeout(function(){e(arguments),n=null},t))}}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"init",value:function(){}}]),e}();t.default=a}]).default});
//# sourceMappingURL=mediaPlayer.min.js.map